<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="group7netctoss.dao.AccountDao"> <!-- 映射的文件 -->

<sql id="columns">acc_id,acc_name,acc_idcard,acc_login,acc_state,acc_job,acc_sex,acc_qq,acc_recidcard,
acc_createtime,acc_recordtime,acc_logintime,acc_psw,acc_tel,acc_ip,acc_email,acc_address,acc_zipcode</sql>

	<select id="selectAllAccount" resultType="Account">
		select <include refid="columns"></include> from account
		<if test="pc!=null">
			order by acc_id limit #{pc.index},#{pc.pageSize}
		</if>
	</select>

	<select id="selectAccount" resultType="Account">
		select <include refid="columns"></include> from account where acc_idcard=#{acc_idcard}
	</select>
	
	<!-- 根据业务id查账务 -->
	<select id="selectAccountBySid" resultType="Account">
		select <include refid="columns"></include> from account where acc_id
		=(select acc_id from service where ser_id=#{ser_id})
	</select>
	
	<!-- 根据账单id查账务 -->
	<select id="selectAccountByBid" resultType="Account">
		select <include refid="columns"></include> from account where acc_id
		=(select acc_id from bill where bill_id=#{bill_id})
	</select>
	
	<!-- 通过条件查询 @author cbw  -->
	<select id="selectAllAccountByCodi" resultType="Account">
		select <include refid="columns" /> from account 
		<where>
			<if test='acc.acc_idcard!=""'>
				acc_idcard=#{acc.acc_idcard}
			</if>
			<if test='acc.acc_name!=""'>
				and acc_name=#{acc.acc_name}
			</if>
			<if test='acc.acc_login!=""'>
				and acc_login=#{acc.acc_login}
			</if>
			<if test='acc.acc_state!="10"'>
				and acc_state=#{acc.acc_state}
			</if>
		</where>
		<if test="pc!=null">
				order by acc_id limit #{pc.index},#{pc.pageSize}
		</if>
	</select>
	
	
	<!-- 通过账务id查询账务信息    @author cbw -->
	<select id="selectAccountById" resultType="Account">
		select * from account where acc_id = #{acc_id} 
	</select>
	
	<!-- 通过账务账号查询账务信息    @author cbw -->
	<select id="selectAccountByAcc" resultType="Account">
		select * from account <!-- where acc_idcard = #{acc_idcard} -->
		<where>
			
			<if test='acc_idcard!="" and acc_idcard!=null'>
				acc_idcard=#{acc_idcard}
			</if>	
			<if test='acc_login!="" and acc_login!=null'>
				acc_login=#{acc_login}
			</if>
				and acc_state!=2
		</where>
	</select>
	
 	<insert id="insertAccount">
 		INSERT INTO account(acc_name,acc_idcard,acc_login,acc_psw,acc_tel,acc_recidcard,acc_email,acc_job,acc_sex,acc_address,acc_zipcode,acc_qq) 
 		VALUE(#{acc_name},#{acc_idcard},#{acc_login},#{acc_psw},#{acc_tel},#{acc_recidcard},#{acc_email},#{acc_job},#{acc_sex},#{acc_address},#{acc_zipcode},#{acc_qq})
 	</insert>
 	<!-- 删除账务账号 -->
 	<update id="deleteAccount">
 		update account set acc_state=2,acc_recordtime=#{acc_recordtime} WHERE acc_id=#{acc_id}
 	</update>
 	<update id="deleteService">
 		update service set ser_state=2,ser_recordtime=now() where ser_id IN (SELECT s.ser_id FROM (SELECT ser_id FROM service  WHERE acc_id=#{acc_id}) s) 
 	</update>
 	<update id="updateAccount">
 		UPDATE  account SET acc_name=#{acc_name},acc_idcard=#{acc_idcard},
		acc_tel=#{acc_tel},acc_recidcard=#{acc_recidcard},acc_email=#{acc_email},acc_job=#{acc_job},acc_sex=#{acc_sex},acc_address=#{acc_address},acc_zipcode=#{acc_zipcode},acc_qq=#{acc_qq},acc_psw=#{acc_psw} WHERE acc_id=#{acc_id}
 	</update>
 	<update id="updateAccountState">
 		update account set acc_state=#{acc_state},acc_recordtime=#{acc_recordtime} WHERE acc_id=#{acc_id}
 	</update>
 	<update id="updateServiceState">
 		UPDATE service SET ser_state=#{acc_state},ser_recordtime=NOW() WHERE ser_id IN (SELECT s.ser_id FROM (SELECT ser_id FROM service  WHERE acc_id=#{acc_id}) s) 

 	</update>
 	
</mapper>